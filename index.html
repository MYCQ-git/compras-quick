<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra de Colchones - Quick</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="video-background">
        <video autoplay muted loop id="bg-video" aria-label="Background video">
          <source src="bg_video.mp4" type="video/mp4" poster="poster.jpg">
          Your browser does not support the video tag.
        </video>
      </div>
    <main>
        <header>
            <div class="header-images">
                <img src="Quick.png" alt="Left Header Image" class="header-image left-image">
                <img src="emma.webp" alt="Right Header Image" class="header-image right-image">
            </div>
            <h1>Compra de Colchones - Quick</h1>
            <p class="subtitle">Adquiere tu colchón a precios exclusivos para empleados</p>
        </header>
        <section>
            <div class="sec_precios-container">
                <div class="sec_precios">
                    <h2 class="precios2">Lista de Colchones Disponibles</h2>
                    <table class="precios">
                        <thead>
                            <tr>
                                <th>Tamaño</th>
                                <th>Precio Quick</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Sencillo</td><td>COP 399,900.00</td></tr>
                            <tr><td>Semidoble</td><td>COP 434,351.35</td></tr>
                            <tr><td>Doble</td><td>COP 505,048.53</td></tr>
                            <tr><td>Queen</td><td>COP 546,016.92</td></tr>
                            <tr><td>King</td><td>COP 583,685.13</td></tr>
                        </tbody>
                    </table>
                </div>
                <img src="colchon.jpg" alt="Image next to sec_precios" class="sec_precios-image">
            </div>
        </section>
        
        <section>
            <h2>Formulario de Compra</h2>
            <form id="compraForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nombre">Nombres:</label>
                        <input type="text" id="nombre" name="nombre" class="entry" required>
                    </div>
                    <div class="form-group">
                        <label for="apellido">Apellidos:</label>
                        <input type="text" id="apellido" name="apellido" class="entry" required>
                    </div>
                    <div class="form-group">
                        <label for="cedula">Cédula:</label>
                        <input type="text" id="cedula" name="cedula" class="entry" required>
                    </div>
                    <div class="form-group">
                        <label for="correo">Correo Electrónico:</label>
                        <input type="email" id="correo" name="correo" class="entry" required>
                    </div>
                    <div class="form-group">
                        <label for="antiguedad">Antigüedad en Quick (años):</label>
                        <input type="number" id="antiguedad" name="antiguedad" class="entry" min="0" max="50" required>
                    </div>
                    <div class="form-group">
                        <label for="colchon">Selecciona el colchón:</label>
                        <select id="colchon" name="colchon" class="entry" required>
                            <option value="Sencillo">Sencillo - COP 399,900.00</option>
                            <option value="Semidoble">Semidoble - COP 434,351.35</option>
                            <option value="Doble">Doble - COP 505,048.53</option>
                            <option value="Queen">Queen - COP 546,016.92</option>
                            <option value="King">King - COP 583,685.13</option>
                        </select>
                    </div>
                </div>
                <div class="spacer"></div>
                <label for="formato_pago">Sube el formato de pago por descuento de nómina:</label>
                <input type="file" id="formato_pago" name="formato_pago" accept=".pdf" class="entry" required>
                <div class="spacer2"></div>
                <button type="submit">Enviar Pedido</button>
            </form>
            <p id="mensaje" style="color: green; font-weight: bold;"></p>
        </section>
        <section>
            <h2>Formato de Descuento de Nómina</h2>
            <p>Descarga y diligencia el siguiente formato para autorizar el descuento de nómina:</p>
            <a href="Autorización de Descuento Quick.docx" download>Descargar Formato</a>
        </section>
        <section>
            <h2>Consulta Precios Directamente en Emma Sleep</h2>
            <p>Si deseas conocer los precios en la tienda oficial, visita el siguiente enlace:</p>
            <a href="https://www.emma-colchon.co/co-colchones/" target="_blank">Ver Precios en Emma Sleep</a>
        </section>
        <footer>
            <p class="subtitle">&copy; 2025 Quick - Todos los derechos reservados</p>
        </footer>
    </main>

    <script>
        document.getElementById('compraForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            const submitButton = form.querySelector('button[type="submit"]');
            const mensaje = document.getElementById('mensaje');
            
            // Disable the submit button to prevent multiple submissions
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            
            // Convert FormData to a plain object
            const formObject = {};
            formData.forEach((value, key) => {
                // Skip the file input for now (handled separately)
                if (key !== 'formato_pago') {
                    formObject[key] = value;
                }
            });
            
            // Get the file if present
            const fileInput = document.getElementById('formato_pago');
            let file = null;
            if (fileInput.files.length > 0) {
                file = fileInput.files[0];
            }
            
            // Prepare the data to send
            const dataToSend = {
                formData: formObject,
                fileName: file ? file.name : '',
                fileType: file ? file.type : ''
            };
            
            // Replace this URL with your Google Apps Script web app URL
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxzo6yiJk4NMnmeFKWDfZSqrtRjb5y39R3Ow8yb0RCL4bG_3okLWHdjACp4wy-m6dH0/exec';
            
            // First send the form data
            fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la red');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    mensaje.textContent = '¡Formulario enviado con éxito!';
                    form.reset();
                    
                    // If there's a file, upload it separately
                    if (file) {
                        return uploadFile(file, data.fileId);
                    }
                } else {
                    throw new Error(data.message || 'Error desconocido');
                }
            })
            .then(fileUploadResult => {
                if (fileUploadResult) {
                    console.log('File uploaded successfully:', fileUploadResult);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                mensaje.textContent = 'Error al enviar el formulario: ' + error.message;
                mensaje.style.color = 'red';
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar Pedido';
            });
        });
        
        function uploadFile(file, fileId) {
            // This would need to be implemented if you want to handle file uploads
            // For GitHub Pages, file uploads are more complex and might require
            // a separate service or using the Google Drive API directly
            console.log('File upload would happen here for file:', file.name);
            return Promise.resolve({ success: true });
        }
    </script>
</body>
</html>
